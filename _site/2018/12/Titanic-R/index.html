<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link href='https://fonts.googleapis.com/css?family=Arvo:400,400italic,700,700italic' rel='stylesheet' type='text/css'>

  <title>Titanic</title>
  <meta name="description" content="```{r}Load packageslibrary(tidyverse)library(formattable)library(gmodels)">
  <meta name="author" content="Shan Jiang">
  <meta name="theme-color" content="">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Titanic">
  <meta property="og:description" content="```{r}Load packageslibrary(tidyverse)library(formattable)library(gmodels)">

  <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
  <link href="/assets/images/favicon.png" rel="shortcut icon" type="image/png">

  <link rel="stylesheet" href="/css/main.css">

  <!-- Custom Fonts -->
  <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
  <!-- Hux change font-awesome CDN to qiniu -->
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- ga & ba script hoook -->
  <script></script>
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="Go to main page of Shan Jiang's hub " class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="Shan Jiang's hub logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Shan Jiang's hub" class="blog-button">Shan Jiang's hub</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">Forever green.</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">Hi, I am Shan(@shanjiang21), a master student at Columbia University.</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        
        <p class="panel-cover__description">Now I am working on Energy insecuirity and applications of data visulization on social science topics, for more information, <a href="https://shanjiang21.github.io/sociology.html">click here</a></p>
        

        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="Visit blog" class="blog-button">Blog</a></li>
                
                  <li class="navigation__item"><a href="https://shanjiang21.github.io/about.html" target="_blank" title="My website introduction">About</a></li>
                
                  <li class="navigation__item"><a href="https://shanjiang21.github.io/Shanjiang_cv2018.pdf" target="_blank" title="My Resume">CV</a></li>
                
                  <li class="navigation__item"><a href="https://shanjiang21.github.io/Footprints.html" target="_blank" title="My Footprint">Footprint</a></li>
                
              </ul>
            </nav>
          </div>

          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">


      <!-- Email -->
      <li class="navigation__item">
        <a href="mailto:sj2921@columbia.edu" title="Contact me">
          <i class='social fa fa-envelope'></i>
          <span class="label">Email</span>
        </a>
      </li>
      

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/shanjiang21" title="@shanjiang21 's Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  


  
  <!-- LinkedIn -->
    <li class="navigation__item">
      <a href="https://linkedin.com/in/shan-jiang-983639153" title="Linkedin page">
        <i class="fa fa-linkedin"></i>
        <span class="label">LinkedIn</span>
      </a>
    </li>
  



  
  <!-- Weibo -->
  <li class="navigation__item">
    <a href="http://weibo.com/jason96026" title="@jason96026 's webo'" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>

    
    <div class="panel-cover--overlay cover-purple"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2018-12-30 01:32:24 -0500" itemprop="datePublished" class="post-meta__date date">2018-12-30</time> &#8226; <span class="post-meta__tags tags"></span>
    </div>
    <h1 class="post-title">Titanic</h1>
  </header>

  <section class="post">
    <pre><code class="language-{r}"># Load packages
library(tidyverse)
library(formattable)
library(gmodels)

</code></pre>

<h2 id="import-web-based-api">Import web-based API</h2>
<p>All web-based 2 APIs have always the same structure:
they consist of a URL to a domain and a path to an endpoint.
For instance: http://example.com/api where http://example.com is the URL and /api is the path to the endpoint.
In recent years, JSON has become the most common answer format by far. JSON is a simple text file that uses special characters and conventions to bring structure into its contents.</p>

<pre><code class="language-{r}">train_raw = read_csv("./data/train.csv")
test_df = read_csv('data/test.csv')
skimr::skim(train_raw)
skimr::skim(test_df)

# identify count of NAs in data frame
sum(is.na(train_raw))
sum(is.na(test_df))

## For data frames, a convenient shortcut to compute the total missing values in each column is to use colSums():

colSums(is.na(train_raw))
colSums(is.na(test_df))

## head of data, formatted   
formattable(head(train_raw)) ## In python: sns.set_style('whitegrid')

train_df  = train_raw %&gt;%
  janitor::clean_names() %&gt;%
  mutate(survived = as.factor(survived))
</code></pre>

<p>There are in total <code class="highlighter-rouge">nrow(train_raw )</code> passengers on the list, while the missing values in total are <code class="highlighter-rouge">sum(is.na(train_df))</code> and sum(is.na(test_df)) respectively.</p>

<p>Actually, with a closer look at the data, we can find missing values mainly fall into the category of
<code class="highlighter-rouge">Cabin</code> and ` Age<code class="highlighter-rouge">, few are in </code>Embarked ` in train dataframe, 1 in <code class="highlighter-rouge">Fare </code> in test_df.</p>

<h2 id="descriptive-statistics">Descriptive statistics</h2>
<pre><code class="language-{r}">## Survived
library(ggplot2)

## survival: 0 = No, 1 = Yes
ggplot(train_df, aes(x = survived, stat = "count")) +
  geom_bar(aes(fill = sex), width = 0.7) +
  coord_flip() +
  theme(legend.position = "top") +
  theme_bw() +
  scale_x_discrete(labels = c("No","Yes")) +
  ggtitle("Survived profile of Titanic passengers")

</code></pre>

<h3 id="dealing-with-missing-value">Dealing with missing value</h3>
<pre><code class="language-{r}">require(randomForest)
## 1. Assign mode value for missing Embarked rows
train_df = train_df %&gt;%
  mutate(embarked = ifelse(is.na(embarked), mode(embarked), embarked)) %&gt;%
## 2. Cabin: assign NA mark for missing entries
  mutate(cabin = ifelse(is.na(cabin), 'u0', cabin))
## 3. Age: an important indicator for prediction, use RandomForest


## choose training data to predict age
age_df = train_raw %&gt;%
  select('Age','Survived','Fare', 'Parch', 'SibSp', 'Pclass')

age_df_notnull =  age_df %&gt;%
  filter( is.na(Age) == F )

age_df_isnull = age_df %&gt;%
  filter( is.na(Age) == T )

# Use RandomForestRegression to train data
RFR = randomForest(
  formula = Age ~ .,
  data  = age_df_notnull)

pred.Age = predict(RFR , age_df_isnull)

## Insert the predicted value for Ages
train_df = train_df %&gt;%
  mutate(age = ifelse(is.na(age), pred.Age, age))

sum(is.na(train_df))
</code></pre>

<h2 id="data-analysis">Data analysis</h2>

<h4 id="1-lady-first-principle">(1). <strong>Lady First</strong> principle</h4>

<pre><code class="language-{r}">## cross tables
corr_df = train_df %&gt;%
  mutate(sex = ifelse(sex == "female", 0, 1)) %&gt;%
  select(survived, pclass, sex, age, sib_sp, parch, fare)

with(train_df, CrossTable(sex, survived))

</code></pre>

<h4 id="2-ticket-class-and-survival-rate-pclass">(2) Ticket class and survival rate: Pclass</h4>

<pre><code class="language-{r}">## 1 = 1st, 2 = 2nd, 3 = 3rd
with(train_df, CrossTable( pclass, survived))

## survival: 0 = No, 1 = Yes

ggplot(train_df, aes(x = as.factor(pclass), stat = "count")) +
  geom_bar(aes(fill = survived), width = 0.7) +
  theme(legend.position = "top") +
  theme_bw() +
  scale_x_discrete(labels = c("1st","2nd", "3rd")) +
  xlab("passenger classes")  +
  ggtitle("Distribution of survival rate among 3 classes on Titanic")

</code></pre>

  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">Latest Article</span>
       <h2 class="post-list__post-title post-title"><a href="/2019/01/Classical-soc-theory/" title="link to Classical sociology theory">Classical sociology theory</a></h2>
       <p class="excerpt">					&lt;center&gt;1&lt;/center&gt;  It may be strange to be offering an exposition of the ideas ...&hellip;</p>
       <div class="post-list__meta"><time datetime="2019-01-05 01:32:24 -0500" class="post-list__meta--date date">2019-01-05</time> &#8226; <span class="post-list__meta--tags tags"></span><a class="btn-border-small" href=/2019/01/Classical-soc-theory/>more</a></div>
   </div>
   

   
</section>

<section class="post-comments">
  
    <div id="disqus_thread"></div>
    <script>

    var disqus_config = function () {
        this.page.url = "http://localhost:4000/2018/12/Titanic-R/";
        this.page.identifier = "/2018/12/Titanic-R/";
    };

    var disqus_shortname = 'shanj';

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>If you want to see <a href="http://disqus.com/?ref_noscript"> Disqus </a>comment，please turn on JavaScript</noscript>

  



</section>


            
<section class="footer">
    <footer>
          Last Updated 
          2018
          
          2019 <a href="https://shanjiang21.github.io/#blog">@Shan_Jiang</a>. Made with <i class="fa fa-heart"></i> with <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a>.
          <a href=""><i class="fa fa-code-fork"></i> this website</a>
            <a Spotted an error? Report it using <a href="shanjiang21/issues">GitHub</a>
</footer>
<br>
    	<span class="footer__copyright">This work is licensed under a <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"> Creative Commons Attribution 4.0 Unported License </a></span>
        <span class="footer__copyright"> &copy; 2019 via <a href="https://jekyllrb.com">Jekyll</a> generated on 2019-04-03 ，Appreciate <a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a> offered a stable vps service</span>

</section>

        </div>
    </div>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript" src="/js/main.js"></script>




  </body>

</html>
